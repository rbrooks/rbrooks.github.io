<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>Russell Brooks | Russ Brooks -   Perfectly Formatted XHTML with PHP or Rails </title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<link href="/stylesheets/main.css" rel="stylesheet" type="text/css" />
	<link href="/stylesheets/lightbox.css" rel="stylesheet" type="text/css" />
	<script src="/javascripts/lightbox2/prototype.js" type="text/javascript"></script>
	<script src="/javascripts/lightbox2/scriptaculous.js?load=effects" type="text/javascript"></script>
	<script src="/javascripts/lightbox2/lightbox.js" type="text/javascript"></script>
	<link href="/feed/atom.xml" rel="alternate" type="application/atom+xml" />
</head>
	<body>
		<div id="wrap">

			<div id="nav">
				<a href="/" class="home" id="current">&nbsp;</a>
				<a href="/portfolio/" class="portfolio">&nbsp;</a>
				<a href="/links/" class="links">&nbsp;</a>
				<a href="/bio/" class="bio">&nbsp;</a>
				<a href="/colophon/" class="colophon">&nbsp;</a>
			</div>

			<div id="banner">
				<img id="bannerpic" src="/images/banner.jpg" width="816" height="186" alt="Autumn Sycamore, by: Russell Brooks" title="Autumn Sycamore, by: Russell Brooks" />
			</div>

			<img src="/images/div_shadow_line.gif" width="904" height="33" alt="" style="float: left;" /><div id="content">
				<div id="content_left">
					
  
<div class="entry entry-38">
	<h2><a href="/2007/4/20/perfectly-formatted-xhtml-with-php-or-rails">Perfectly Formatted XHTML with PHP or Rails</a></h2> 
	<p class="date">April 20th, 2007</p>

	
		<h2>Old School</h2>

<p>Here is a common method of outputting table rows to the page in PHP.  The benefits are that it is probably a microsecond faster due to lack of context-switching.  The problem is that the XHTML output is horrendous.</p>
		
		
		
		  <p>It&#8217;s difficult to see what&#8217;s going on in the PHP portion of the page.  Our XHTML is marred with echo() statements.  Visually, it&#8217;s a mess&#8212;difficult for the human eye to work with, on both the code side and browser side.</p>

<table class="CodeRay"><tr>
  <td class="line_numbers" title="click to toggle" onclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1<tt>
</tt>2<tt>
</tt>3<tt>
</tt>4<tt>
</tt>5<tt>
</tt>6<tt>
</tt>7<tt>
</tt>8<tt>
</tt>9<tt>
</tt><strong>10</strong><tt>
</tt>11<tt>
</tt>12<tt>
</tt>13<tt>
</tt>14<tt>
</tt>15<tt>
</tt>16<tt>
</tt></pre></td>
  <td class="code"><pre ondblclick="with (this.style) { overflow = (overflow == 'auto' || overflow == '') ? 'visible' : 'auto' }">$rs = $DB-&gt;Execute(&quot;SELECT * FROM products WHERE cat_id = 123&quot;);<tt>
</tt><tt>
</tt>echo('&lt;table&gt;');<tt>
</tt>while (!$rs-&gt;EOF()) {<tt>
</tt>    echo('&lt;tr&gt;');<tt>
</tt>    echo('&lt;td&gt;');<tt>
</tt>    echo($rs-&gt;Fields['name']);<tt>
</tt>    echo('&lt;/td&gt;');<tt>
</tt>    echo('&lt;td&gt;');<tt>
</tt>    echo($rs-&gt;Fields['price']);<tt>
</tt>    echo('&lt;/td&gt;');<tt>
</tt>    echo('&lt;/tr&gt;');<tt>
</tt><tt>
</tt>    $rs-&gt;MoveNext();<tt>
</tt>}<tt>
</tt>echo('&lt;/table&gt;');</pre></td>
</tr></table>

<h3>Browser Output</h3>

<pre><code>&lt;table&gt;&lt;tr&gt;&lt;td&gt;Widgets&lt;/td&gt;&lt;td&gt;$29.95&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
</code></pre>

<p>As you can see, the above causes XHTML output to be flush left and all on the same line.  With large pages of this type of XHTML, debugging rendering issues becomes arduous.  It&#8217;s very difficult to find the culprit of a mysterious browser issue when your XHTML is unformatted.</p>

<h2>Mixed-Mode Old School</h2>

<p>To get around this, you will see developers use mixed-mode, but use it so that the XHTML is better, but still not formatted 100% correct.</p>

<table class="CodeRay"><tr>
  <td class="line_numbers" title="click to toggle" onclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1<tt>
</tt>2<tt>
</tt>3<tt>
</tt>4<tt>
</tt>5<tt>
</tt>6<tt>
</tt>7<tt>
</tt>8<tt>
</tt>9<tt>
</tt><strong>10</strong><tt>
</tt>11<tt>
</tt></pre></td>
  <td class="code"><pre ondblclick="with (this.style) { overflow = (overflow == 'auto' || overflow == '') ? 'visible' : 'auto' }">&lt;table&gt;<tt>
</tt>&lt;? $rs = $DB-&gt;Execute(&quot;SELECT * FROM products WHERE cat_id = 123&quot;);<tt>
</tt>while (!$rs-&gt;EOF()) { ?&gt;<tt>
</tt>    &lt;tr&gt;<tt>
</tt>        &lt;td&gt;<tt>
</tt>            &lt;?= $rs-&gt;Fields['name']; ?&gt;&lt;/td&gt;<tt>
</tt>    &lt;/tr&gt;<tt>
</tt>&lt;?<tt>
</tt>    $rs-&gt;MoveNext();<tt>
</tt>}?&gt;<tt>
</tt>&lt;/table&gt;</pre></td>
</tr></table>

<p>This is better, but let&#8217;s look at the output.</p>

<h3>Browser Output</h3>

<pre><code>&lt;table&gt;

    &lt;tr&gt;
        &lt;td&gt;
            Widgets&lt;/td&gt;
        &lt;td&gt;
            $29.95&lt;/td&gt;
    &lt;/tr&gt;

    &lt;tr&gt;
        &lt;td&gt;
            Widgets&lt;/td&gt;
        &lt;td&gt;
            $29.95&lt;/td&gt;
    &lt;/tr&gt;

&lt;/table&gt;
</code></pre>

<p>Notice the undesirable, extra carriage returns within the table rows.  Let&#8217;s move those PHP delimiters to consume those carriage returns and produce perfect XHTML.</p>

<h2>Perfection</h2>

<p>If you are an XHTML perfectionist, a better method is to align the PHP delimiters so  the XHTML is formatted perfectly.  Everything from opening delimiter to closing one renders to the browser as a null.  To see what the browser output will look like, in your code editor, highlight the PHP code from opening delimiter to closing.  Ctrl-X or Delete to cut it out of your code.  The result is what will output to the browser.  Undo the cut, Ctrl-Z.</p>

<table class="CodeRay"><tr>
  <td class="line_numbers" title="click to toggle" onclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1<tt>
</tt>2<tt>
</tt>3<tt>
</tt>4<tt>
</tt>5<tt>
</tt>6<tt>
</tt>7<tt>
</tt>8<tt>
</tt>9<tt>
</tt><strong>10</strong><tt>
</tt>11<tt>
</tt></pre></td>
  <td class="code"><pre ondblclick="with (this.style) { overflow = (overflow == 'auto' || overflow == '') ? 'visible' : 'auto' }">&lt;table&gt;<tt>
</tt>&lt;?<tt>
</tt>$rs = $DB-&gt;Execute(&quot;SELECT * FROM products WHERE cat_id = 123&quot;);<tt>
</tt>while (!$rs-&gt;EOF()) {<tt>
</tt>?&gt;    &lt;tr&gt;<tt>
</tt>        &lt;td&gt;<tt>
</tt>            &lt;?= $rs-&gt;Fields['name']; ?&gt;&lt;/td&gt;<tt>
</tt>    &lt;/tr&gt;<tt>
</tt>&lt;?<tt>
</tt>}<tt>
</tt>?&gt;&lt;/table&gt;</pre></td>
</tr></table>

<h3>Browser Output</h3>

<pre><code>&lt;table&gt;
    &lt;tr&gt;
        &lt;td&gt;
            Widgets&lt;/td&gt;
        &lt;td&gt;
            $29.95&lt;/td&gt;
    &lt;/tr&gt;
&lt;/table&gt;
</code></pre>

<p>When used correctly, this technique can output perfect XHTML from page top to bottom&#8212;perfect indentation, perfect carriage returns.</p>

<p>You can let the PHP code follow its own indentation context on the left side. Let the XHTML markup follow its own indent context as well.  In other words, indent the PHP, based on the PHP, regardless of the XHTML.  Indent the HTML based on the HTML&#8212;ignore the PHP.  Once you get used to looking at the code this way, it&#8217;s much faster to wield.  You can glance at page full of PHP/XHTML mix and immediately see the PHP vs. the XHTML - each in its own indentation context.  I should have a Photoshop shot up soon of what I mean by this.</p>

<h2>The Rails Way</h2>

<p>Rails has an ingenious way of dealing with this problem.  I was so impressed that the Rails developers had thought to include this.  XHTML rendering was of significant importance to someone besides me.  You simply terminate your block of Ruby code with a minus sign [-] in front of the closing delimiter -%>.  This causes the carriage return to not render.  Brilliant.  Thank you, Rails developers.  I&#8217;ve been waiting about six years for someone solve the problem.</p>

<table class="CodeRay"><tr>
  <td class="line_numbers" title="click to toggle" onclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1<tt>
</tt>2<tt>
</tt>3<tt>
</tt>4<tt>
</tt>5<tt>
</tt></pre></td>
  <td class="code"><pre ondblclick="with (this.style) { overflow = (overflow == 'auto' || overflow == '') ? 'visible' : 'auto' }">&lt;li&gt;&lt;%= link_to 'Website', dispatch_path([]) %&gt;&lt;/li&gt;<tt>
</tt>&lt;% if admin? -%&gt;<tt>
</tt>&lt;li&gt;&lt;%= link_to 'Settings', :controller =&gt; 'settings' %&gt;&lt;/li&gt;<tt>
</tt>&lt;% end -%&gt;<tt>
</tt>&lt;li&gt;&lt;%= link_to &quot;Users&quot;,    :controller =&gt; &quot;users&quot; %&gt;&lt;/li&gt;</pre></td>
</tr></table>

<h3>Browser Output</h3>

<pre><code>&lt;li&gt;&lt;a href=""&gt;Website&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=""&gt;Settings&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=""&gt;Users&lt;/a&gt;&lt;/li&gt;
</code></pre>

<p>Notice there are no carriage returns between elements.  Use the -%> religiously.</p>
		
	
	<p class="comment_links">
		<span class="postedby">Posted by rbrooks</span>
		<span class="filedto">Filed in <a href="/php">PHP</a>, <a href="/ruby-on-rails">Ruby on Rails</a></span>
	
	</p>
	
</div>


  <div class="commentsblock">
    





<form id="comment-form" method="post" action="/2007/4/20/perfectly-formatted-xhtml-with-php-or-rails/comments#comment-form">
<fieldset id="addComment">
	<legend runat="server" id="legComment">Add Comment</legend>

	<p class="fieldReq">White fields are required.</p>

	<div class="fieldReq">
		<label for="author">Name :</label>
		<input type="text" id="comment_author" name="comment[author]" value="" />
	</div>
	<div class="fieldNotReq">
		<label for="email">Email :</label>
		<input type="text" id="comment_author_email" name="comment[author_email]" value="" />
	</div>
	<div class="fieldNotReq">
		<label for="url">Website :</label>
		<input type="text" id="comment_author_url" name="comment[author_url]" value="" />
	</div>
	<div class="fieldReq">
		<label for="comment">Comment :</label><br />
		<textarea name="comment[body]" id="comment" rows="12"></textarea>
	</div>
</fieldset>
<p><input name="submit" type="submit" id="submit" value="Post Comment" class="btn" /></p>
</form>

<p><strong>Posting Info:</strong> <a href="http://daringfireball.net/projects/markdown/syntax">Markdown</a> and <a href="http://daringfireball.net/projects/smartypants/">SmartyPants</a> are supported for formatting and punctuation respectively. Your email address will never be published. Your name will link to your website address, if entered. Inappropriate comments will be edited or deleted.</p>



  </div>



				</div>
    				<img src="/images/div_archives.gif" alt="Archives" style="float: left;" />
	    			<div id="sidebar_right">
    					<img src="/images/title_categories.gif" width="68" height="9" alt="Categories" title="Categories" class="sidebar_subhead" />
					<ul>
							<li><a href="/">Home</a></li><li><a href="/ruby-on-rails">Ruby on Rails</a></li><li><a href="/web-design">Web Design</a></li><li><a href="/artwork">Artwork</a></li><li><a href="/php">PHP</a></li>
					</ul>
					<form method="get" id="sform" action="/search">
						<img src="/images/title_search.gif" width="43" height="9" alt="Search" title="Search" class="sidebar_subhead" /><br />
						<div class="fieldNotReq">
							<input type="text" id="q" value="" name="q" size="25" />
						</div>
					</form>
    				</div>
    			</div>
			<div id="footer">
	    			<p>
        				<a href="/">HOME</a> |

	<a href="/portfolio">Portfolio</a> | <a href="/links">Links</a> | <a href="/bio">Bio</a> | <a href="/colophon">Colophon</a> | 
<br />
        				Copyright &copy; 2007; Russell H. Brooks
    				</p>
    			</div>
    		</div>
    		<script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script>
    		<script type="text/javascript">
    		    		_uacct = "UA-1695100-1";
    		    		urchinTracker();
    		</script>
	</body>
</html>